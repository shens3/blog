<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    
    <title>
        学习URI |
        
        狗蛋儿</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="什么是URIURI的特征：  统一：有规定的语法 资源：互联网上的资源，比如文件、服务；现实生活中的资源，比如书 标识符：字符串包含了资源的信息，可以是名称可以是定位信息  以上的组合标识了一个资源。规范里强调，URI 的作用仅仅是资源的标识，并不代表资源可访问或则存在。 URI 与 URL、URN的关系   URI：统一资源标识符 URL：统一资源定位符 URN：统一资源名称  一个 URI 可">
<meta property="og:type" content="article">
<meta property="og:title" content="学习URI">
<meta property="og:url" content="https://shens3.github.io/blog/2020/03/learn-URI/">
<meta property="og:site_name" content="狗蛋儿">
<meta property="og:description" content="什么是URIURI的特征：  统一：有规定的语法 资源：互联网上的资源，比如文件、服务；现实生活中的资源，比如书 标识符：字符串包含了资源的信息，可以是名称可以是定位信息  以上的组合标识了一个资源。规范里强调，URI 的作用仅仅是资源的标识，并不代表资源可访问或则存在。 URI 与 URL、URN的关系   URI：统一资源标识符 URL：统一资源定位符 URN：统一资源名称  一个 URI 可">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://shens3.github.io/blog/2020/03/learn-URI/uri_type.png">
<meta property="og:image" content="https://shens3.github.io/blog/2020/03/learn-URI/uri_syntax.png">
<meta property="og:image" content="https://shens3.github.io/blog/2020/03/learn-URI/uri_encode_location.png">
<meta property="og:image" content="https://shens3.github.io/blog/2020/03/learn-URI/uri_encode_http.png">
<meta property="article:published_time" content="2020-03-27T09:01:24.000Z">
<meta property="article:modified_time" content="2020-03-31T15:37:44.848Z">
<meta property="article:author" content="shens3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shens3.github.io/blog/2020/03/learn-URI/uri_type.png">
    
    
    
<link rel="stylesheet" href="/blog/style/july.css">

    
<link rel="stylesheet" href="/blog/style/markdown.css">

<meta name="generator" content="Hexo 4.2.0"></head>
<body>

<div id="banner-outer" class="">
    <div id="banner-image" style="background-image: url(/blog/img/kitty.jpg)"></div>
    <img src="/blog/img/avatar.jpeg" id="avatar">
</div>

<div id="menu-outer">
    <div id="menu-inner">
        
            <a class="false" href="/blog/">Home</a>
        
            <a class="false" href="/blog/archives/">Archives</a>
        
    </div>
</div>

<div id="content-outer" class="container">
    <div id="content-inner">
        <article id="post">
    <h1 id="post-title">学习URI</h1>
    <time id="post-date" datetime="2020-03-27T09:01:24.000Z">
        三月 27, 2020
    </time>
    <div id="post-content" class="markdown-body">
        <h2 id="什么是URI"><a href="#什么是URI" class="headerlink" title="什么是URI"></a>什么是URI</h2><p>URI的特征：</p>
<ul>
<li>统一：有规定的语法</li>
<li>资源：互联网上的资源，比如文件、服务；现实生活中的资源，比如书</li>
<li>标识符：字符串包含了资源的信息，可以是名称可以是定位信息</li>
</ul>
<p>以上的组合标识了一个资源。规范里强调，URI 的作用仅仅是资源的标识，并不代表资源可访问或则存在。</p>
<h3 id="URI-与-URL、URN的关系"><a href="#URI-与-URL、URN的关系" class="headerlink" title="URI 与 URL、URN的关系"></a>URI 与 URL、URN的关系</h3><img src="/blog/2020/03/learn-URI/uri_type.png" class="no-shadow" width="300" title="uri子类型">

<ul>
<li>URI：统一资源标识符</li>
<li>URL：统一资源定位符</li>
<li>URN：统一资源名称</li>
</ul>
<p>一个 URI 可以是 URL，也可以是 URN，也可以即是 URL 又是 URN。如果一个 URI 中的信息包含了指向资源的位置，比如网络中的服务器域名和路径，那么就可以认为这是一个 URL。如果一个 URI 中包含了该资源的全局唯一名称，那么可以认为这个是一个 URN。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>从左到右是一个权重递减的层次结构，每个部件的顺序不能颠倒。圆形框为分割符，方形框为部件，黄色内为可选，大括号内是该部分内部可能有的组成情况。</p>
<img src="/blog/2020/03/learn-URI/uri_syntax.png" class="" title="uri通用语法">

<h3 id="scheme"><a href="#scheme" class="headerlink" title="scheme"></a>scheme</h3><p>大小写不敏感，字母开头，可由<code>数字</code>、<code>字母</code>、<code>-</code>、<code>+</code> 、<code>.</code>组成。不同的 scheme 定义为不同的 URI，每个 scheme 都有可以规定自己子部件的语法规范。</p>
<h3 id="path"><a href="#path" class="headerlink" title="path"></a>path</h3><p>可由<code>非保留字符</code>、<code>可选分割符</code>、<code>/</code>、<code>:</code>、<code>@</code>组成。<code>/</code>是作为层次结构的分割符。path 的语法以前面是否有 authority 大体分为两种情况：</p>
<ol>
<li>有 authority<span style="color: red;">（path-abempty）</span><ol>
<li>以 <code>/</code> 开头</li>
<li>为空</li>
</ol>
</li>
<li>无 authority<ol>
<li>以 <code>/</code> 开头，但不能以 <code>//</code> 开头<span style="color: red;">（path-absolute）</span></li>
<li>不能以 <code>/</code>、<code>:</code> 开头<span style="color: red;">（path-noscheme）</span></li>
<li>合法字符<span style="color: red;">（path-rootless）</span></li>
<li>为空<span style="color: red;">（path-empty）</span></li>
</ol>
</li>
</ol>
<p>上述这些情况有对应的 URI 使用场景，详细在<a href="#%e7%94%a8%e6%b3%95">用法</a>中介绍。</p>
<h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><p>从第一个 <code>?</code> 后的字符开始，到 <code>#</code> 字符或则 URI 尾部结束。可由<code>非保留字符</code>、<code>可选分割符</code>、<code>/</code>、<code>:</code>、<code>@</code>、<code>?</code>组成。这部件没有定义层次结构，常常用来列举需要传递的参数。每个 scheme 可根据自己的需要定义数据的分割符和数据的展现形式。</p>
<h3 id="fragment"><a href="#fragment" class="headerlink" title="fragment"></a>fragment</h3><p>从第一个 <code>#</code> 后的字符开始，到 URI 尾部结束。可由<code>非保留字符</code>、<code>可选分割符</code>、<code>/</code>、<code>:</code>、<code>@</code>、<code>?</code>组成。fragment 部分的含义与特定 scheme 无关，与这个URI 所标识的资源的 MIME 类型有关，因为相当于指向的是所标识资源中的某个部分。</p>
<h3 id="浏览器相关API"><a href="#浏览器相关API" class="headerlink" title="浏览器相关API"></a>浏览器相关API</h3><h4 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h4><ul>
<li>href: URI</li>
<li>origin: baseURI</li>
<li>protocol: scheme + ‘:’</li>
<li>host: host</li>
<li>port: port</li>
<li>pathname: path</li>
<li>search: query </li>
<li>hash: fragment</li>
</ul>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>URI 由一组有限字符集组成，即 ASCII 字符集。规范中提供了一种编码方式，为了展示字符集中无符号表示的字符，如控制字符；为了区分 URI 中存在与保留字符相同的普通字符；为了展示 ASCII 范围以外属于其他字符编码的字符。这种方式为<strong>百分号编码</strong>，以一个字节为单位。</p>
<blockquote>
<p>% HEX HEX</p>
</blockquote>
<p>字符的分类：</p>
<ul>
<li>保留字符：<ul>
<li>通用分割符：<code>:</code>、<code>@</code>、<code>/</code>、<code>:</code>、<code>?</code>、<code>#</code>、<code>[</code>、<code>]</code></li>
<li>可选分割符：<code>;</code>、<code>&amp;</code>、<code>=</code>、<code>*</code>、<code>$</code>、<code>,</code>、<code>(</code>、<code>)</code>、<code>+</code>、<code>!</code>、<code>&#39;</code></li>
</ul>
</li>
<li>非保留字符：<code>数字</code>、<code>字母</code>、<code>-</code>、<code>_</code>、<code>.</code>、<code>~</code></li>
</ul>
<p>一般来说在用字符组装一个 URI 时才需要考虑编码问题，需要编码的情况有：</p>
<ol>
<li>控制字符，<code>0x00</code> 到 <code>0x20</code>，<code>0x7F</code></li>
<li>不安全字符， <code>{</code>、<code>}</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&quot;</code>、<code>|</code>、<code>\</code>、<code>^</code>、<code>%</code>、<code>`</code></li>
<li>非保留目的保留字符</li>
</ol>
<h3 id="浏览器对-URL-的编码行为"><a href="#浏览器对-URL-的编码行为" class="headerlink" title="浏览器对 URL 的编码行为"></a>浏览器对 URL 的编码行为</h3><p>URI 规定超出 ASCII 编码的字符需要使用百分号编码，但是没有规定这些字符使用的字符编码，这很大程度上取决于浏览器的行为。我在 chrome 上进行了实验，分别在地址栏、提交表单、发送 ajax 请求这三种方式输入包含中文的 URI，结果是在地址栏被百分号编码的字节是 UTF-8，而在 form 和 ajax 中与文档的编码有关。</p>
<img src="/blog/2020/03/learn-URI/uri_encode_location.png" class="" title="uri浏览器地址栏编码">

<img src="/blog/2020/03/learn-URI/uri_encode_http.png" class="" title="uri浏览器表单编码">

<table>
<thead>
<tr>
<th align="center">不同方式</th>
<th align="center">编码</th>
</tr>
</thead>
<tbody><tr>
<td align="center">地址栏</td>
<td align="center">UTF-8</td>
</tr>
<tr>
<td align="center">form</td>
<td align="center">文档的编码</td>
</tr>
<tr>
<td align="center">ajax</td>
<td align="center">文档的编码</td>
</tr>
</tbody></table>
<p><code>深</code>的GBK编码的字节为 <code>0xC9EE</code>，UTF-8 为 <code>0xE6B7B1</code>。</p>
<blockquote>
<p>chrome 55版本后不支持自定义页面编码，需要自己安装插件 Charset</p>
</blockquote>
<h3 id="浏览器相关API-1"><a href="#浏览器相关API-1" class="headerlink" title="浏览器相关API"></a>浏览器相关API</h3><h4 id="encodeURI"><a href="#encodeURI" class="headerlink" title="encodeURI"></a>encodeURI</h4><p>该方法对不符合URI规范的字符进行百分号编码，对应解码方法 <code>decodeURI</code>。</p>
<p>转义的字符有：第1种情况、第2种情况 和 <code>[</code>、<code>]</code>。</p>
<p>按照标准，方括号在 <code>ipv6</code> 中有特殊含义，不应该被转义，可以使用以下代码修复。</p>
<pre><code class="js">function fixEncode(str) {
  return encodeURI(str).replace(/%5B/g, &#39;[&#39;).replace(/%5D/g, &#39;]&#39;);
}</code></pre>
<h4 id="encodeURIComponent"><a href="#encodeURIComponent" class="headerlink" title="encodeURIComponent"></a>encodeURIComponent</h4><p>该方法对不符合HTTP URI 部件规范的字符进行百分号编码，对应解码方法 <code>decodeURIComponent</code>。HTTP URI 中 query 的部分 <code>&amp;</code>、<code>=</code> 是有特殊含义的，所以需要用此函数来转码。</p>
<p>该方法不转义5个属于保留字符的字符有：<code>!</code>、<code>*</code>、<code>&#39;</code>、<code>(</code>、<code>)</code>，为了更加安全规范建议可以自己转义。</p>
<pre><code class="js">function safelyEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[\!\*&#39;\(\)]/g, escape(&#39;$0&#39;));
}</code></pre>
<p>关于 <code>appliaction/x-www-form-urlencode</code> 规定，<code>POST</code> 数据中空格需要被转成 +</p>
<pre><code class="js">function spToPlus(str) {
  return safelyEncodeURIComponent(str).replace(/%20/g, &#39;+&#39;);
}</code></pre>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="Relative-Reference"><a href="#Relative-Reference" class="headerlink" title="Relative Reference"></a>Relative Reference</h3><p>利用分层结构，可以省略之前的部件。对应上文提到的 <a href="#path">path</a> 部分列出的其中4种情况。</p>
<ul>
<li>1：与引用文档是使用相同 scheme 的关系</li>
<li>2.1：与引用文档是使用相同 scheme 和 authority 的关系，即常说的绝对路径</li>
<li>2.2：与引用文档有相对的关系，根据..、.来判断，即常说的相对路径</li>
</ul>
<h3 id="Absolute-URI"><a href="#Absolute-URI" class="headerlink" title="Absolute URI"></a>Absolute URI</h3><p>除去 fragment 部分的URI，称为base uri。</p>
<h3 id="Same-Document-Reference"><a href="#Same-Document-Reference" class="headerlink" title="Same-Document Reference"></a>Same-Document Reference</h3><p>URI 合并后，如果与引用文档的 URI 对比后，fragment 之前的部分都相同，即为同文档引用。不会指向新的资源。</p>
<h3 id="Suffix-Reference"><a href="#Suffix-Reference" class="headerlink" title="Suffix Reference"></a>Suffix Reference</h3><p>比如 <code>www.w3.org/Addressing/</code>，这是偏向人类方便的用法。最终需要靠程序去猜测，因为 <code>www</code> 一般为 <code>http://</code> 开头，但不建议这么使用，因为不保证 scheme 是否会发送变化。</p>
<br>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">rfc3986</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent" target="_blank" rel="noopener">encodeURIComponent, MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI" target="_blank" rel="noopener">encodeURI, MDN</a></li>
</ul>

    </div>
</article>

<div id="paginator">
    
</div>

    </div>
</div>

<div id="bottom-outer">
    <div id="bottom-inner">
        2019-2020 shens3 
    </div>
</div>

<div id="to-top">
    <i class="iconfont icon-up"></i>
</div>


    
        
<script src="/blog/js/jquery-3.4.1.min.js"></script>

    
        
<script src="/blog/js/highlight-9.13.1.min.js"></script>

    
        
<script src="/blog/js/transition.js"></script>

    
        
<script src="/blog/js/smooth-scroll.min.js"></script>

    



    <script>
      $(function () {
        $('#banner-outer').addClass('fade-out')
        $('#menu-outer').addClass('fade-show')

        $('pre').each(function (i, block) {
          hljs.highlightBlock(block);
        });
      })
    </script>


<script>
  $(function () {
    $(window).scroll(function () {
      if ($(window).scrollTop() > 150) {
        $("#to-top").fadeIn();
      } else {
        $("#to-top").fadeOut();
      }
    });
    $("#to-top").click(function () {
      $("body,html").animate({scrollTop: 0}, 500);
      return false;
    })
  })
</script>
</body>
</html>
